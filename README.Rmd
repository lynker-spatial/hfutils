---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%",
  warning = FALSE
)
```

<!-- badges: start -->
[![License: Apache License (>= 2)](https://img.shields.io/badge/License-Apache%20License%20%28%3E%3D%202%29-blue.svg)](https://choosealicense.com/licenses/apache-2.0/)
[![LifeCycle](https://img.shields.io/badge/lifecycle-experimental-orange)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![Dependencies](https://img.shields.io/badge/dependencies-16/49-red?style=flat)](#)
[![Website](https://github.com/mikejohnson51/hfutils/actions/workflows/pkgdown.yaml/badge.svg)](https://github.com/mikejohnson51/hfutils/actions/workflows/pkgdown.yaml)
<!-- badges: end -->

# Hydrofabric Utilities

`hfutils` provides the base utilities needed for hydrofabric I/O + navigation; geometry modification + cleaning; and authentication to the Lynker Spatial cloud. Collectively, it provides the building blocks from which reference fabrics and geoprocessed fabrics can be created.


## Installation

You can install the development version of `hfutils` from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("lynker-spatial/hfutils")
```

```{r,message=FALSE}
library(hfutils)
library(dplyr)
```

## Basic Use

### I/O

#### Basic connection: Dataset

```{r, eval = TRUE}
gpkg <- '/Users/mikejohnson/hydrofabric/v3.0/reference_fabric.gpkg'
hfutils::as_ogr(gpkg)
```

#### Basic connection: Layer

```{r, eval = TRUE}
hfutils::as_ogr(gpkg, "divides") 
```

#### Lazy Eval

```{r, eval = TRUE}
hfutils::as_ogr(gpkg, "divides") |> 
  select(divide_id, areasqkm) 
```

#### sf extraction

```{r, eval = TRUE}
hfutils::as_ogr(gpkg, "divides")  |> 
  filter(vpuid == "01") |> 
  st_as_sf()
```

### Network Properties

```{r}
## Accumulate Downstream
system.time({
  da <-  hfutils::as_ogr(gpkg, 'flowpaths')  |> 
  filter(vpuid == "01") |> 
  st_as_sf() |> 
  accumulate_downstream(attr = "areasqkm")})

head(da)

## Hydrosequence
system.time({
  hs <-  hfutils::as_ogr(gpkg, 'flowpaths')  |> 
  filter(vpuid == "01") |> 
  st_as_sf() |> 
  get_hydroseq()
})

head(hs)
```

### Questions?

Please reach out via an issue or PR if you have comments, concerns, or questions!
